(function(e){function t(t){for(var i,s,o=t[0],d=t[1],l=t[2],u=0,h=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&h.push(a[s][0]),a[s]=0;for(i in d)Object.prototype.hasOwnProperty.call(d,i)&&(e[i]=d[i]);c&&c(t);while(h.length)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var d=n[o];0!==a[d]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={app:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/vue-three-rhinoviewer/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],d=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var c=d;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0976":function(e,t,n){"use strict";n("2cb0")},"2cb0":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("ViewPort",{ref:"viewcomp"})],1)},r=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"ViewPort"}},[n("NavPanel",{attrs:{layertree:e.layertree,layervisibles:e.layervisible,layerexpanded:e.layerexpanded,bloburl:e.bloburl,id:"sidebar"},on:{input:e.inputdone,adjust:e.adjustdone,savefile:e.saveFile,fileinput:e.fileinputdone}}),n("div",{ref:"stage",attrs:{id:"viewmain"}})],1)},o=[],d=n("1da1"),l=(n("96cf"),n("b0c0"),n("caad"),n("2532"),n("d3b7"),n("25f0"),n("ac1f"),n("466d"),n("3ca3"),n("ddb0"),n("2b3d"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",{staticClass:"d-flex",attrs:{id:"navmenu",flat:"",tile:"",height:"100vh",width:e.openLayer?e.navwidth+e.layerwidth:e.navwidth}},[n("v-navigation-drawer",{ref:"navdrawer",attrs:{"mini-variant":"",permanent:""}},[n("v-list",{attrs:{dense:"",nav:""}},[n("v-list-item",{attrs:{link:""},on:{click:function(t){e.openLayer=!e.openLayer}}},[n("v-list-item-icon",[n("v-icon",{attrs:{color:"black"}},[e._v("mdi-layers-outline")])],1),n("v-list-item-content",[e._v(" Layer ")])],1),n("v-list-item",{attrs:{link:""}},[n("v-list-item-icon",[n("label",{staticClass:"navicon",attrs:{for:"fileinput"}},[n("v-icon",{attrs:{color:"black"}},[e._v("mdi-folder-open-outline")]),n("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"fileinput",name:"fileinput",accept:".3dm"}})],1)]),n("v-list-item-content",[e._v(" File ")])],1),n("v-list-item",{attrs:{link:""}},[n("v-list-item-icon",[n("v-icon",{attrs:{color:"black"},on:{click:e.adjustdone}},[e._v("mdi-fit-to-page-outline")])],1),n("v-list-item-content",[e._v(" Adjust Object ")])],1),n("v-list-item",{attrs:{link:""}},[n("v-list-item-icon",[n("div",[n("a",{attrs:{rel:"ar",href:e.bloburl,download:"model.usdz"}},[n("img",{staticClass:"naviconimg",attrs:{src:"cube-scan.svg"}})])])]),n("v-list-item-content",[e._v(" AR View ")])],1)],1)],1),n("v-card",{directives:[{name:"show",rawName:"v-show",value:e.openLayer,expression:"openLayer"}],attrs:{height:"100%",flat:"",tile:""}},[n("v-navigation-drawer",{ref:"layerdrawer",attrs:{width:e.layerwidth,permanent:""}},[n("v-treeview",{attrs:{selectable:"",dense:"","on-icon":"mdi-eye","off-icon":"mdi-eye-off-outline",items:e.layertree,value:e.layervisibles,open:e.layerexpanded},on:{input:e.inputdone}})],1)],1)],1)}),c=[],u={name:"NavPanel",props:["layertree","layervisibles","layerexpanded","bloburl"],data:function(){return{openLayer:!1,minnavwidth:200,navwidth:56,layerwidth:200}},methods:{resize:function(e){document.body.style.cursor="ew-resize",this.layerwidth=Math.max(e.clientX-this.navwidth,this.minnavwidth)},setEvents:function(){var e=this,t=this.$refs.layerdrawer.$el,n=t.querySelector(".v-navigation-drawer__border");n.addEventListener("mousedown",(function(n){n.stopPropagation(),n.preventDefault(),t.style.transition="initial",document.addEventListener("mousemove",e.resize,!1)}),!1),n.addEventListener("mouseenter",(function(){document.body.style.cursor="ew-resize"}),!1),n.addEventListener("mouseleave",(function(){document.body.style.cursor=""}),!1),document.addEventListener("mouseup",(function(){t.style.transition="",document.body.style.cursor="",document.removeEventListener("mousemove",e.resize,!1)}),!1)},inputdone:function(e){this.$emit("input",e)},adjustdone:function(){this.$emit("adjust")},emitsavefile:function(){this.$emit("savefile")},fileinputdone:function(e){this.$emit("fileinput",e)},fileChange:function(e){var t=e.target,n=t.files[0];this.fileinputdone(n)}},mounted:function(){this.setEvents();var e=document.getElementById("fileinput");e.addEventListener("change",this.fileChange,!1),console.log(this.bloburl)}},h=u,v=(n("ccc0"),n("2877")),p=n("6544"),f=n.n(p),m=n("b0af"),b=n("132d"),w=n("8860"),y=n("da13"),g=n("5d23"),j=n("34c3"),O=n("f774"),x=n("eb2a"),L=Object(v["a"])(h,l,c,!1,null,"1c9ec067",null),E=L.exports;f()(L,{VCard:m["a"],VIcon:b["a"],VList:w["a"],VListItem:y["a"],VListItemContent:g["a"],VListItemIcon:j["a"],VNavigationDrawer:O["a"],VTreeview:x["a"]});var P=n("5a89"),D=n("4721"),M=n("b07c"),_=n("9a3e"),k={components:{NavPanel:E},name:"ViewPort",data:function(){var e=new P["B"],t=new P["L"]({antialias:!0,logarithmicDepthBuffer:!0}),n=new P["v"](45,1,1,2e5),i=new P["j"](16777215,4473924,1),a=new P["f"](16777215,3);a.position.set(1,2,-2),a.castShadow=!0;var r=new M["a"];return{scene:e,renderer:t,camera:n,controls:null,light:i,dirlight:a,loader:r,loadObj:null,loadObjEdges:{},reader:new FileReader,layertree:[],layervisible:[],layerexpanded:[],bloburl:null}},created:function(){this.scene.add(this.camera),this.scene.add(this.light),this.scene.add(this.dirlight),this.scene.background=new P["e"](10526880)},mounted:function(){this.$refs.stage.appendChild(this.renderer.domElement),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.outputEncoding=P["M"],this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=P["u"],window.addEventListener("resize",this.onWindowResize),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.position.set(3,3,6),this.camera.updateProjectionMatrix(),this.controls=new D["a"](this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.update(),this.reader.addEventListener("load",this.fileLoad,!1),this.loader.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@0.15.0-beta/"),this.load3dm("sample.3dm"),this.animate()},methods:{animate:function(){requestAnimationFrame(this.animate),this.renderer.render(this.scene,this.camera)},onWindowResize:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},load3dm:function(e){this.loader.load(e,function(e){if(this.loadObj)for(var t in this.scene.remove(this.loadObj),this.loadObjEdges)this.scene.remove(this.loadObjEdges[t]),delete this.loadObjEdges[t];e.rotation.set(-Math.PI/2,0,0),e.updateMatrix(),this.loadObj=e,this.scene.add(this.loadObj),this.layertree=[],this.layervisible=[],this.layerexpanded=[];var n={"00000000-0000-0000-0000-000000000000":{id:-1,parents:null,child:[],data:{}}};for(var i in e.userData.layers)if(Object.hasOwnProperty.call(e.userData.layers,i)){var a=e.userData.layers[i];n[a.id]={id:i,parents:a.parentLayerId,child:[],data:{name:a.name,color:a.color,expanded:a.expanded,visible:a.visible}},a.visible&&this.layervisible.push(i),a.expanded&&this.layerexpanded.push(i)}for(var r in e.userData.layers)if(Object.hasOwnProperty.call(e.userData.layers,r)){var s=e.userData.layers[r];n[s.parentLayerId].child.push(s.id)}this.layertree=this.bakeTree(n,"00000000-0000-0000-0000-000000000000").children,e.traverse(function(t){if(Object.prototype.hasOwnProperty.call(t.userData,"attributes")){var n=t.userData.attributes.layerIndex;if("Mesh"==t.type){var i=new P["g"](t.geometry,60),a=new P["m"](i,new P["l"]({color:0}));a.rotation.set(-Math.PI/2,0,0),a.updateMatrix(),this.loadObjEdges[t.uuid]=a,this.loadObjEdges[t.uuid].visible=e.userData.layers[n].visible,this.scene.add(this.loadObjEdges[t.uuid])}t.visible=e.userData.layers[n].visible}}.bind(this)),this.adjustCamera(e),this.createBlob()}.bind(this))},bakeTree:function(e,t){var n=e[t],i=[];for(var a in n.child){var r=e[n.child[a]];0==r.child.length?i.push({id:r.id,name:r.data.name}):i.push(this.bakeTree(e,n.child[a]))}return{id:n.id,name:n.data.name,children:i}},adjustCamera:function(e){var t=new P["a"];t.setFromObject(e);var n=t.getBoundingSphere(new P["C"]),i=this.camera.getEffectiveFOV(),a=this.camera.fov*this.camera.aspect,r=Math.min(i,a),s=new P["K"];this.camera.getWorldDirection(s);var o=Math.sin(r*Math.PI/360),d=s.clone(),l=n.radius/o;d.multiplyScalar(-l);var c=n.center.clone().add(d);this.camera.position.copy(c),this.camera.far=5*l,this.camera.lookAt(n.center),this.camera.updateProjectionMatrix(),this.controls.target.copy(n.center),this.controls.update()},inputdone:function(e){this.scene.traverse(function(t){Object.hasOwnProperty.call(t.userData,"attributes")&&"layerIndex"in t.userData.attributes&&(t.visible=e.includes(t.userData.attributes.layerIndex.toString()),"Mesh"==t.type&&(this.loadObjEdges[t.uuid].visible=t.visible))}.bind(this))},adjustdone:function(){this.adjustCamera(this.loadObj)},fileinputdone:function(e){e.name.match(/.+\.3dm/)?(this.reader.readAsDataURL(e),this.load3dm(this.reader.result),console.log("file changed")):alert("3dmファイルのみ対応")},fileLoad:function(){this.load3dm(this.reader.result)},createBlob:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=new _["a"],i=e.scene.clone(),i.scale.set(.001,.001,.001),i.updateMatrixWorld(!0),t.next=6,n.parse(i);case 6:a=t.sent,r=new Blob([a],{type:"application/octet-stream"}),e.bloburl=URL.createObjectURL(r);case 9:case"end":return t.stop()}}),t)})))()},saveFile:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=new _["a"],i=e.scene.clone(),i.scale.set(.001,.001,.001),i.updateMatrixWorld(!0),t.next=6,n.parse(i);case 6:a=t.sent,r=new Blob([a],{type:"application/octet-stream"}),e.bloburl=URL.createObjectURL(r),console.log(e.bloburl),s=Object.assign(document.createElement("a"),{download:"model.usdz",rel:"ar",href:e.bloburl}),s.click();case 12:case"end":return t.stop()}}),t)})))()}}},W=k,R=(n("0976"),Object(v["a"])(W,s,o,!1,null,"70141be0",null)),V=R.exports,I={name:"App",components:{ViewPort:V},data:function(){return{drag:Boolean,file:null}},methods:{onWDrop:function(e){e.stopPropagation(),e.preventDefault(),this.drag=!1,e&&e.dataTransfer&&0!==e.dataTransfer.files.length&&(this.file=e.dataTransfer.files[0],this.$refs.viewcomp.fileinputdone(this.file))},onWEnter:function(e){e.stopPropagation(),e.preventDefault(),this.drag=!0},onWLeave:function(e){e.stopPropagation(),e.preventDefault(),this.drag=!1},onWDragOver:function(e){e.preventDefault()}},mounted:function(){document.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1}),window.addEventListener("dragenter",this.onWEnter,!1),window.addEventListener("drop",this.onWDrop,!1),window.addEventListener("dragleave",this.onWLeave,!1),window.addEventListener("dragover",this.onWDragOver,!1)}},S=I,z=n("7496"),C=Object(v["a"])(S,a,r,!1,null,"f48a3318",null),$=C.exports;f()(C,{VApp:z["a"]});var T=n("f309");i["a"].use(T["a"]);var B=new T["a"]({});i["a"].config.productionTip=!1,new i["a"]({vuetify:B,render:function(e){return e($)}}).$mount("#app")},ccc0:function(e,t,n){"use strict";n("ead3")},ead3:function(e,t,n){}});
//# sourceMappingURL=app.2fe7bed3.js.map